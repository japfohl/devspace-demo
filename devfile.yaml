schemaVersion: 2.2.0

metadata:
  name: demo
  version: 0.0.1

components:
  - name: runtime
    container:
      endpoints:
        - name: app-server
          targetPort: 3000
          protocol: https
      image: quay.io/devfile/universal-developer-image:ubi8-latest
      memoryLimit: 4Gi
      memoryRequest: 2Gi

  - name: test-env
    container:
      image: docker.io/joepfohl/playwright-headed-root:latest
      sourceMapping: /projects
      mountSources: true
      command: ['tail', '-f', '/dev/null']
      

commands:
  # set up project packages manager and install dependencies
  - id: npm-install
    exec:
      commandLine: "npm install"
      component: runtime
      workingDir: ${PROJECT_SOURCE}

  # run development server
  - id: dev
    exec:
      commandLine: "npm run dev -w=web-app"
      component: runtime
      hotReloadCapable: true
      workingDir: ${PROJECT_SOURCE}
  
  # run e2e tests in testenv
  - id: e2e
    exec:
      commandLine: 'npm run e2e -w=web-app'
      component: test-env
      workingDir: ${PROJECT_SOURCE}

events:
  postStart:
    - npm-install
