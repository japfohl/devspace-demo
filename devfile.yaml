schemaVersion: 2.2.0
metadata:
  name: demo
  version: 0.0.1
components:
  - name: runtime
    container:
      endpoints:
        - name: app-server
          targetPort: 3000
          protocol: https
      image: quay.io/devfile/universal-developer-image:ubi8-latest
      memoryLimit: 4Gi
      memoryRequest: 2Gi
      
  - name: test-env
    container:
      image: mcr.microsoft.com/playwright:v1.39.0-jammy
      command: ['tail', '-f', '/dev/null']
      sourceMapping: /projects
      mountSources: true
commands:
  # set up project packages manager and install dependencies
  - exec:
      commandLine: "bash $PROJECT_SOURCE/scripts/init"
      component: runtime
    id: init
  # run development server
  - exec:
      commandLine: "pnpm run --filter web-app dev"
      component: runtime
      hotReloadCapable: true
      workingDir: ${PROJECT_SOURCE}
    id: dev
events:
  postStart:
    - init
